<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>新一代低延时网络传输协议QUIC | LIANYONGXING. BLOG</title>
    <meta name="description" content="May the force be with u.">
    <meta name="generator" content="VuePress 1.4.0">
    <link rel="icon" href="ficon.jpeg">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/2.10.0/github-markdown.min.css">
    
    <link rel="preload" href="/assets/css/0.styles.a5323663.css" as="style"><link rel="preload" href="/assets/js/app.acaacfed.js" as="script"><link rel="preload" href="/assets/js/2.858fe96a.js" as="script"><link rel="preload" href="/assets/js/13.acff38a0.js" as="script"><link rel="prefetch" href="/assets/js/10.652038c7.js"><link rel="prefetch" href="/assets/js/100.2dd9d0f2.js"><link rel="prefetch" href="/assets/js/101.487a243a.js"><link rel="prefetch" href="/assets/js/102.0c61121f.js"><link rel="prefetch" href="/assets/js/103.4dbe63e3.js"><link rel="prefetch" href="/assets/js/104.7f502b03.js"><link rel="prefetch" href="/assets/js/105.6e83f9e6.js"><link rel="prefetch" href="/assets/js/106.5409dca1.js"><link rel="prefetch" href="/assets/js/107.7ad54acd.js"><link rel="prefetch" href="/assets/js/108.3486f36a.js"><link rel="prefetch" href="/assets/js/109.5ee4cd3b.js"><link rel="prefetch" href="/assets/js/11.4f8ea0df.js"><link rel="prefetch" href="/assets/js/110.6417250e.js"><link rel="prefetch" href="/assets/js/111.ded28c89.js"><link rel="prefetch" href="/assets/js/112.94f5b6c6.js"><link rel="prefetch" href="/assets/js/113.3b1fe42e.js"><link rel="prefetch" href="/assets/js/114.0e643f0c.js"><link rel="prefetch" href="/assets/js/115.32a16f28.js"><link rel="prefetch" href="/assets/js/12.a9ef9aaf.js"><link rel="prefetch" href="/assets/js/14.113e66b1.js"><link rel="prefetch" href="/assets/js/15.19b59d69.js"><link rel="prefetch" href="/assets/js/16.4ee77b14.js"><link rel="prefetch" href="/assets/js/17.a5b6d566.js"><link rel="prefetch" href="/assets/js/18.744a9950.js"><link rel="prefetch" href="/assets/js/19.fd9e7099.js"><link rel="prefetch" href="/assets/js/20.66903b5c.js"><link rel="prefetch" href="/assets/js/21.c98f5d06.js"><link rel="prefetch" href="/assets/js/22.a0056c91.js"><link rel="prefetch" href="/assets/js/23.73369199.js"><link rel="prefetch" href="/assets/js/24.dc5b3fc5.js"><link rel="prefetch" href="/assets/js/25.bf612edb.js"><link rel="prefetch" href="/assets/js/26.b9dd7686.js"><link rel="prefetch" href="/assets/js/27.371379cd.js"><link rel="prefetch" href="/assets/js/28.4a33fe83.js"><link rel="prefetch" href="/assets/js/29.be42af3d.js"><link rel="prefetch" href="/assets/js/3.47952932.js"><link rel="prefetch" href="/assets/js/30.37bd8e9e.js"><link rel="prefetch" href="/assets/js/31.58f89f44.js"><link rel="prefetch" href="/assets/js/32.741f73e3.js"><link rel="prefetch" href="/assets/js/33.a9c7dcb5.js"><link rel="prefetch" href="/assets/js/34.c3f829b5.js"><link rel="prefetch" href="/assets/js/35.29c897d0.js"><link rel="prefetch" href="/assets/js/36.1e02f622.js"><link rel="prefetch" href="/assets/js/37.a1d23a14.js"><link rel="prefetch" href="/assets/js/38.06964860.js"><link rel="prefetch" href="/assets/js/39.384a454e.js"><link rel="prefetch" href="/assets/js/4.7feb14c8.js"><link rel="prefetch" href="/assets/js/40.c7e4dfb7.js"><link rel="prefetch" href="/assets/js/41.3e5c5125.js"><link rel="prefetch" href="/assets/js/42.dcf19498.js"><link rel="prefetch" href="/assets/js/43.54203bcb.js"><link rel="prefetch" href="/assets/js/44.9cccb36c.js"><link rel="prefetch" href="/assets/js/45.3ce2a56c.js"><link rel="prefetch" href="/assets/js/46.17aac222.js"><link rel="prefetch" href="/assets/js/47.57ed0257.js"><link rel="prefetch" href="/assets/js/48.8baebce7.js"><link rel="prefetch" href="/assets/js/49.7eb16be5.js"><link rel="prefetch" href="/assets/js/5.55c31470.js"><link rel="prefetch" href="/assets/js/50.06274b55.js"><link rel="prefetch" href="/assets/js/51.b50e24a8.js"><link rel="prefetch" href="/assets/js/52.7b92239f.js"><link rel="prefetch" href="/assets/js/53.fb7cbb6a.js"><link rel="prefetch" href="/assets/js/54.d047b5f1.js"><link rel="prefetch" href="/assets/js/55.6e2fd120.js"><link rel="prefetch" href="/assets/js/56.fa7ee707.js"><link rel="prefetch" href="/assets/js/57.31b7d0a7.js"><link rel="prefetch" href="/assets/js/58.80cddbc7.js"><link rel="prefetch" href="/assets/js/59.92b2b0f2.js"><link rel="prefetch" href="/assets/js/6.792ce084.js"><link rel="prefetch" href="/assets/js/60.9ab8e458.js"><link rel="prefetch" href="/assets/js/61.b3abbf87.js"><link rel="prefetch" href="/assets/js/62.2bde1ed2.js"><link rel="prefetch" href="/assets/js/63.39cf6423.js"><link rel="prefetch" href="/assets/js/64.c839079e.js"><link rel="prefetch" href="/assets/js/65.ea1754c1.js"><link rel="prefetch" href="/assets/js/66.802ec528.js"><link rel="prefetch" href="/assets/js/67.a30d6fff.js"><link rel="prefetch" href="/assets/js/68.d98ac090.js"><link rel="prefetch" href="/assets/js/69.083b1217.js"><link rel="prefetch" href="/assets/js/7.3964fa52.js"><link rel="prefetch" href="/assets/js/70.272720ba.js"><link rel="prefetch" href="/assets/js/71.386b54d7.js"><link rel="prefetch" href="/assets/js/72.005e615f.js"><link rel="prefetch" href="/assets/js/73.b1266355.js"><link rel="prefetch" href="/assets/js/74.9ab08f58.js"><link rel="prefetch" href="/assets/js/75.eefe4ff0.js"><link rel="prefetch" href="/assets/js/76.e4162716.js"><link rel="prefetch" href="/assets/js/77.e1ead4d7.js"><link rel="prefetch" href="/assets/js/78.ae9b9cc3.js"><link rel="prefetch" href="/assets/js/79.eeaf4627.js"><link rel="prefetch" href="/assets/js/8.5ccbfc45.js"><link rel="prefetch" href="/assets/js/80.0272858c.js"><link rel="prefetch" href="/assets/js/81.bbc0907f.js"><link rel="prefetch" href="/assets/js/82.4de7fcc4.js"><link rel="prefetch" href="/assets/js/83.2ad342e1.js"><link rel="prefetch" href="/assets/js/84.3398b3bb.js"><link rel="prefetch" href="/assets/js/85.be446d7c.js"><link rel="prefetch" href="/assets/js/86.1ef2094d.js"><link rel="prefetch" href="/assets/js/87.53795a29.js"><link rel="prefetch" href="/assets/js/88.1c3ba029.js"><link rel="prefetch" href="/assets/js/89.a4797bc8.js"><link rel="prefetch" href="/assets/js/9.1e695694.js"><link rel="prefetch" href="/assets/js/90.12ceffe8.js"><link rel="prefetch" href="/assets/js/91.40c9fc92.js"><link rel="prefetch" href="/assets/js/92.9648154b.js"><link rel="prefetch" href="/assets/js/93.d4e90cec.js"><link rel="prefetch" href="/assets/js/94.50b5eb64.js"><link rel="prefetch" href="/assets/js/95.9d54c125.js"><link rel="prefetch" href="/assets/js/96.fce496cb.js"><link rel="prefetch" href="/assets/js/97.86a56b4e.js"><link rel="prefetch" href="/assets/js/98.cf20fa6d.js"><link rel="prefetch" href="/assets/js/99.92c0c3e3.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a5323663.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">LIANYONGXING. BLOG</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/index.html" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Blog" class="dropdown-title"><span class="title">Blog</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/NLP/" class="nav-link">
  NLP
</a></li><li class="dropdown-item"><!----> <a href="/blog/machineLearning/" class="nav-link">
  MachineLearning
</a></li><li class="dropdown-item"><!----> <a href="/blog/Papers/" class="nav-link">
  Papers
</a></li><li class="dropdown-item"><!----> <a href="/blog/recommenderSystem/" class="nav-link">
  RecommenderSystem
</a></li><li class="dropdown-item"><!----> <a href="/blog/ObjectDetection/" class="nav-link">
  ObjectDetection
</a></li><li class="dropdown-item"><!----> <a href="/blog/os/" class="nav-link">
  OperatorSystem
</a></li><li class="dropdown-item"><!----> <a href="/blog/cookies/" class="nav-link router-link-active">
  Cookies
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/lianyongxing" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/about/" class="nav-link">
  About
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/index.html" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Blog" class="dropdown-title"><span class="title">Blog</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/NLP/" class="nav-link">
  NLP
</a></li><li class="dropdown-item"><!----> <a href="/blog/machineLearning/" class="nav-link">
  MachineLearning
</a></li><li class="dropdown-item"><!----> <a href="/blog/Papers/" class="nav-link">
  Papers
</a></li><li class="dropdown-item"><!----> <a href="/blog/recommenderSystem/" class="nav-link">
  RecommenderSystem
</a></li><li class="dropdown-item"><!----> <a href="/blog/ObjectDetection/" class="nav-link">
  ObjectDetection
</a></li><li class="dropdown-item"><!----> <a href="/blog/os/" class="nav-link">
  OperatorSystem
</a></li><li class="dropdown-item"><!----> <a href="/blog/cookies/" class="nav-link router-link-active">
  Cookies
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/lianyongxing" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/about/" class="nav-link">
  About
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/blog/cookies/" class="sidebar-link">概述</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>基于RTMP协议的流媒体视频直播</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Prometheus+Grafana+Mongodb数据可视化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Docker</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>搭建MongoDb分片集群</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Pycharm远程调试</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>2019研究生数学建模B题</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Python日志模块Logging</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>新一代低延时网络传输协议QUIC</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/cookies/新一代低延时网络传输协议QUIC/新一代低延时网络传输协议QUIC.html" class="active sidebar-link">新一代低延时网络传输协议QUIC</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/cookies/新一代低延时网络传输协议QUIC/新一代低延时网络传输协议QUIC.html#quic协议概述" class="sidebar-link">QUIC协议概述</a></li><li class="sidebar-sub-header"><a href="/blog/cookies/新一代低延时网络传输协议QUIC/新一代低延时网络传输协议QUIC.html#quic的核心特性" class="sidebar-link">QUIC的核心特性</a></li><li class="sidebar-sub-header"><a href="/blog/cookies/新一代低延时网络传输协议QUIC/新一代低延时网络传输协议QUIC.html#总结" class="sidebar-link">总结</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>分布式系统相关</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="新一代低延时网络传输协议quic"><a href="#新一代低延时网络传输协议quic" class="header-anchor">#</a> 新一代低延时网络传输协议QUIC</h1> <h2 id="quic协议概述"><a href="#quic协议概述" class="header-anchor">#</a> QUIC协议概述</h2> <p>Quic全称quick udp internet connection，“快速UDP互联网连接”，是一种利用udp进行多路并发传输的协议</p> <p>QUIC是用来替代TCP、SSL/TLS的传输层协议，常用的HTTP、FTP、IMAP等应用层协议理论上都可以运行在QUIC上</p> <h2 id="quic的核心特性"><a href="#quic的核心特性" class="header-anchor">#</a> QUIC的核心特性</h2> <h3 id="建立连接时延低"><a href="#建立连接时延低" class="header-anchor">#</a> 建立连接时延低</h3> <p>QUIC协议具有0RTT的特点。</p> <p><img src="/assets/img/93C6431E-70AE-4A1E-9BFB-0D0631636C90.27ad4744.jpg" alt="27ad474455f82f0115b2838709e7833e"></p> <p>从左图可以看出，传统TCP连接后HTTP发送数据需要3RTT，而使用QUIC，只需要首次连接1RTT，后续连接只需0RTT，意味着客户端发给服务端的第一个包就带有请求数据。</p> <p>从右图看，QUIC的请求过程分为以下几步</p> <ul><li><p>首次连接时，客户端发送Inchoate Client Hello 给服务端，用于请求连接</p></li> <li><p>服务端生成g、p、a，根据g、p、a计算出A，然后将g、p、A放到Server Config中再发送Rejection消息给客户端</p></li> <li><p>客户端收到g、p、A，自己生成b，根据g、p、b算出B，根据A、p、b算出初始密钥K。B和K算好后，客户端用K加密HTTP数据，连同B一起发送给服务端</p></li> <li><p>服务端收到B后，根据a、p、B生成与客户端相同的密钥，再用这个密钥解密收到的HTTP数据。为了进一步的安全，服务端会更新自己的随机数a和公钥，再生成新的密钥S，然后把公钥通过Server Hello发送给客户端，连同Server Hello消息，还有HTTP返回数据</p></li> <li><p>客户端收到Server Hello后，生成与服务端一致的新密钥S，后面的传输都使用S加密</p></li></ul> <p>整个过程，QUIC从请求连接到发送HTTP数据一共花了1RTT，这1个RTT主要是获取Server Config，后面的连接如果客户端缓存了ServerConfig，那么就可以直接发送HTTP数据，实现0RTT建立连接</p> <p><img src="/assets/img/77E86F65-AD97-4B93-8997-475EC6CDC883.77a09f26.jpg" alt="77a09f268acd7b615dd66e97b5556001"></p> <h3 id="连接迁移"><a href="#连接迁移" class="header-anchor">#</a> 连接迁移</h3> <p>TCP连接基于四元组（源IP、源端口、目的IP、目的端口），切换网络一个元素发生变化，则连接发生变化。</p> <p>如果连接发生变化时，还使用原来的TCP连接，则会连接失败，就必须等连接超时后重新建立连接</p> <p>QUIC的连接不受四元组的影响，当四元组发生变化时，原来的连接状态仍然保持</p> <p>其原理是，QUIC的连接不以四元组作为标识，而是使用一个64位的随机数，这个随机数成为你的Connection ID，即使IP或端口发生变化，只要这个Connection ID没有变化，仍然可以维持连接</p> <h3 id="多路复用-队头阻塞"><a href="#多路复用-队头阻塞" class="header-anchor">#</a> 多路复用/队头阻塞</h3> <h4 id="队头阻塞"><a href="#队头阻塞" class="header-anchor">#</a> 队头阻塞</h4> <p>TCP是面向连接的协议，每次发送请求后，都需要收到ACK来保证对方接收到数据。如果每次请求都要在收到上次的ACK后再请求，那么效率会很低，之后Http1.1提出了<u>Pipelining</u>技术，允许一个TCP连接同时发送多个请求，提高了传输效率</p> <p><img src="/assets/img/C9896591-1929-4BEB-AEB9-8DCE57C4D341.bd51ec87.jpg" alt="bd51ec87a33b9351169df4ce1caafc72"></p> <p>但是，Pipelining会带来<u>队头阻塞问题</u></p> <p><img src="/assets/img/071A8F61-756B-4EC8-90F1-80DC88A67757.45099ef3.jpg" alt="45099ef325ea101ee4e85bb2ea923da4"></p> <p>在上图中，一个TCP连接中，同时传输10个请求，其中1、2、3个请求被接收，但第4个请求丢失，那么后面的请求会发生阻塞，浪费了带宽资源</p> <h4 id="多路复用"><a href="#多路复用" class="header-anchor">#</a> 多路复用</h4> <p>在Http/2中，多路复用技术解决了上述队头阻塞的问题</p> <p>不像http/1.1中只有上一个请求的所有数据包被传输，Http/2中每个请求被拆分为多个Frame，通过一条TCP<br>
连接同时被传输，这样即使一个请求阻塞，也不会影响其他请求，不同颜色代表不同请求，相同颜色的色块代表请求被切分的frame</p> <p><img src="/assets/img/B5A47F82-AC98-4DE8-ADB7-E6EBF36A7359.46f503eb.jpg" alt="46f503eb7b1ecdb5544f1a878e664d4f"></p> <p>Http/2解决了“请求”这个粒度的阻塞，但是其基础协议TCP也会存在队头阻塞的问题。HTTP/2的每个请求都会被拆分成多个frame。不同请求的frame组合成stream，stream是TCP上的逻辑传输单元，这样 HTTP/2 就达到了一条连接同时发送多条请求的目标，这就是多路复用的原理。</p> <p><img src="/assets/img/ED893A00-601F-4359-A8CA-7F4E1C058D55.7be8f328.jpg" alt="7be8f328434495770be317330f8058a9"></p> <p>如上图所示，在一条TCP连接上同时发送4个Stream，其中1到达，2中的第三个frame丢失，因此会要求重发第三个frame，3、4已经到达却不能被处理，整条链路被阻塞。</p> <p>而且Http/2必须使用Https，因此其中的TLS协议也会存在队头阻塞的问题。</p> <p>QUIC解决队头阻塞有两点：</p> <ol><li>QUIC的传输单元是Packet，加密单元也是Packet，整个加密、传输、解密都基于Packet，因此可以避免TLS队头阻塞的问题</li> <li>QUIC基于UDP，UDP的数据包在接收端没有处理顺序，因此中间丢失一个包，也不会阻塞整条连接，其他资源会被正常处理</li></ol> <h3 id="拥塞控制"><a href="#拥塞控制" class="header-anchor">#</a> 拥塞控制</h3> <p>拥塞控制的目的是避免过多的数据一下子进入网络，导致网络超出负荷。QUIC的拥塞控制与TCP类似，并且在此基础上做了改进，TCP的拥塞控制由4个核心算法组成</p> <ul><li>慢启动：发送方向接收方发送1个单位的数据，收到对方确认后会发送2个单位的数据，然后依次是4个8个……呈指数级增长，这个过程就是在不断试探网络的拥塞程度，超出阈值则会导致网络拥塞；</li> <li>拥塞避免：指数增长不可能是无限的，到达某个限制（慢启动阈值）之后，指数增长变为线性增长；</li> <li>快速重传：发送方每一次发送时都会设置一个超时计时器，超时后即认为丢失，需要重发；</li> <li>快速恢复：在上面快速重传的基础上，发送方重新发送数据时，也会启动一个超时定时器，如果收到确认消息则进入拥塞避免阶段，如果仍然超时，则回到慢启动阶段。</li></ul> <p>QUIC重新实现了TCP协议的Cubic算法，并做了改进。</p> <h4 id="热插拔"><a href="#热插拔" class="header-anchor">#</a> 热插拔</h4> <p>TCP 中如果要修改拥塞控制策略，需要在系统层面进行操作。QUIC 修改拥塞控制策略只需要在<u>应用层</u>操作，<u>并且 QUIC 会根据不同的网络环境、用户来动态选择拥塞控制算法</u>。</p> <h4 id="单调递增的packet-number"><a href="#单调递增的packet-number" class="header-anchor">#</a> 单调递增的Packet Number</h4> <p>TCP 为了保证可靠性，使用 Sequence Number 和 ACK 来确认消息是否有序到达，但这样的设计存在缺陷。</p> <p>当产生重传后，收到ACK的确认消息，此时无法确定此ACK是第一次传输还是重传的确认信息</p> <p>而QUIC的Packet Number是单调递增的，因此如果Packet N丢失了，重传时的Packet标识不会是N，而是大于N的数字，这样发送方就能清楚的知道是原始请求还是重传请求的确认信息</p> <h4 id="ack-delay"><a href="#ack-delay" class="header-anchor">#</a> ACK Delay</h4> <p>TCP 计算 RTT 时没有考虑接收方接收到数据到发送确认消息之间的延迟。QUIC 考虑了这段延迟，使得 RTT 的计算更加准确。</p> <p><img src="/assets/img/C55C40ED-9BCF-4663-AAD3-CAB82ED22E86.6f16b4ff.jpg" alt="6f16b4ff744f4901e4e3afcb51fb7f2d"></p> <h4 id="更多ack块"><a href="#更多ack块" class="header-anchor">#</a> 更多ACK块</h4> <p>一般来说，接收方收到发送方的消息后都应该发送一个 ACK 回复，表示收到了数据。但每收到一个数据就返回一个 ACK 回复太麻烦，所以一般不会立即回复，而是接收到多个数据后再回复，TCP SACK 最多提供 3 个 ACK block。但有些场景下，比如下载，只需要服务器返回数据就好，但按照 TCP 的设计，每收到 3 个数据包就要“礼貌性”地返回一个 ACK。而 QUIC 最多可以捎带 256 个 ACK block。在丢包率比较严重的网络下，更多的 ACK block 可以减少重传量，提升网络效率。</p> <h3 id="流量控制"><a href="#流量控制" class="header-anchor">#</a> 流量控制</h3> <p>TCP会对每个连接进行流量控制，让发送方不要发送太快，要让接收方来得及接收，不然会导致数据溢出而丢失。</p> <p>TCP的流量控制主要通过滑动窗口实现。拥塞控制主要是控制发送方的发送策略，流量控制考虑了接收方的接收能力。</p> <p>QUIC 只需要建立一条连接，在这条连接上同时传输多条 Stream。QUIC 的流量控制有两个级别：连接级别（Connection Level）和 Stream 级别（Stream Level），既要控制这条路的总流量，不要一下子很多车辆涌进来，货物来不及处理，也不能一个车辆一下子运送很多货物，这样货物也来不及处理。</p> <p>单条 Stream 的流量控制。Stream 还没传输数据时，接收窗口（flow control receive window）就是最大接收窗口（flow control receive window），随着接收方接收到数据后，接收窗口不断缩小。在接收到的数据中，有的数据已被处理，而有的数据还没来得及被处理。</p> <p>当越来越多的数据被处理后，可接收的数据又会增加，开始接收更多数据</p> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <p>QUIC基于UDP，借鉴了TCP、TLS、HTTP/2的特性，但更简洁，具有零RTT建立连接、连接迁移、多路复用、拥塞控制、流量控制等优秀的特点，是一个更安全高效可靠的HTTP通信协议。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/cookies/Python的日志模块/Python的日志模块Logging.html" class="prev">
        Logging模块
      </a></span> <span class="next"><a href="/blog/cookies/distributedSystem/一致性Hash.html">
        一致性Hash算法
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.acaacfed.js" defer></script><script src="/assets/js/2.858fe96a.js" defer></script><script src="/assets/js/13.acff38a0.js" defer></script>
  </body>
</html>
