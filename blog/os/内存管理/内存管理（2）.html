<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>内存管理之二 | LIANYONGXING. BLOG</title>
    <meta name="description" content="May the force be with u.">
    <meta name="generator" content="VuePress 1.4.0">
    <link rel="icon" href="ficon.jpeg">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/2.10.0/github-markdown.min.css">
    
    <link rel="preload" href="/assets/css/0.styles.a5323663.css" as="style"><link rel="preload" href="/assets/js/app.acaacfed.js" as="script"><link rel="preload" href="/assets/js/2.858fe96a.js" as="script"><link rel="preload" href="/assets/js/5.55c31470.js" as="script"><link rel="prefetch" href="/assets/js/10.652038c7.js"><link rel="prefetch" href="/assets/js/100.2dd9d0f2.js"><link rel="prefetch" href="/assets/js/101.487a243a.js"><link rel="prefetch" href="/assets/js/102.0c61121f.js"><link rel="prefetch" href="/assets/js/103.4dbe63e3.js"><link rel="prefetch" href="/assets/js/104.7f502b03.js"><link rel="prefetch" href="/assets/js/105.6e83f9e6.js"><link rel="prefetch" href="/assets/js/106.5409dca1.js"><link rel="prefetch" href="/assets/js/107.7ad54acd.js"><link rel="prefetch" href="/assets/js/108.3486f36a.js"><link rel="prefetch" href="/assets/js/109.5ee4cd3b.js"><link rel="prefetch" href="/assets/js/11.4f8ea0df.js"><link rel="prefetch" href="/assets/js/110.6417250e.js"><link rel="prefetch" href="/assets/js/111.ded28c89.js"><link rel="prefetch" href="/assets/js/112.94f5b6c6.js"><link rel="prefetch" href="/assets/js/113.3b1fe42e.js"><link rel="prefetch" href="/assets/js/114.0e643f0c.js"><link rel="prefetch" href="/assets/js/115.32a16f28.js"><link rel="prefetch" href="/assets/js/12.a9ef9aaf.js"><link rel="prefetch" href="/assets/js/13.acff38a0.js"><link rel="prefetch" href="/assets/js/14.113e66b1.js"><link rel="prefetch" href="/assets/js/15.19b59d69.js"><link rel="prefetch" href="/assets/js/16.4ee77b14.js"><link rel="prefetch" href="/assets/js/17.a5b6d566.js"><link rel="prefetch" href="/assets/js/18.744a9950.js"><link rel="prefetch" href="/assets/js/19.fd9e7099.js"><link rel="prefetch" href="/assets/js/20.66903b5c.js"><link rel="prefetch" href="/assets/js/21.c98f5d06.js"><link rel="prefetch" href="/assets/js/22.a0056c91.js"><link rel="prefetch" href="/assets/js/23.73369199.js"><link rel="prefetch" href="/assets/js/24.dc5b3fc5.js"><link rel="prefetch" href="/assets/js/25.bf612edb.js"><link rel="prefetch" href="/assets/js/26.b9dd7686.js"><link rel="prefetch" href="/assets/js/27.371379cd.js"><link rel="prefetch" href="/assets/js/28.4a33fe83.js"><link rel="prefetch" href="/assets/js/29.be42af3d.js"><link rel="prefetch" href="/assets/js/3.47952932.js"><link rel="prefetch" href="/assets/js/30.37bd8e9e.js"><link rel="prefetch" href="/assets/js/31.58f89f44.js"><link rel="prefetch" href="/assets/js/32.741f73e3.js"><link rel="prefetch" href="/assets/js/33.a9c7dcb5.js"><link rel="prefetch" href="/assets/js/34.c3f829b5.js"><link rel="prefetch" href="/assets/js/35.29c897d0.js"><link rel="prefetch" href="/assets/js/36.1e02f622.js"><link rel="prefetch" href="/assets/js/37.a1d23a14.js"><link rel="prefetch" href="/assets/js/38.06964860.js"><link rel="prefetch" href="/assets/js/39.384a454e.js"><link rel="prefetch" href="/assets/js/4.7feb14c8.js"><link rel="prefetch" href="/assets/js/40.c7e4dfb7.js"><link rel="prefetch" href="/assets/js/41.3e5c5125.js"><link rel="prefetch" href="/assets/js/42.dcf19498.js"><link rel="prefetch" href="/assets/js/43.54203bcb.js"><link rel="prefetch" href="/assets/js/44.9cccb36c.js"><link rel="prefetch" href="/assets/js/45.3ce2a56c.js"><link rel="prefetch" href="/assets/js/46.17aac222.js"><link rel="prefetch" href="/assets/js/47.57ed0257.js"><link rel="prefetch" href="/assets/js/48.8baebce7.js"><link rel="prefetch" href="/assets/js/49.7eb16be5.js"><link rel="prefetch" href="/assets/js/50.06274b55.js"><link rel="prefetch" href="/assets/js/51.b50e24a8.js"><link rel="prefetch" href="/assets/js/52.7b92239f.js"><link rel="prefetch" href="/assets/js/53.fb7cbb6a.js"><link rel="prefetch" href="/assets/js/54.d047b5f1.js"><link rel="prefetch" href="/assets/js/55.6e2fd120.js"><link rel="prefetch" href="/assets/js/56.fa7ee707.js"><link rel="prefetch" href="/assets/js/57.31b7d0a7.js"><link rel="prefetch" href="/assets/js/58.80cddbc7.js"><link rel="prefetch" href="/assets/js/59.92b2b0f2.js"><link rel="prefetch" href="/assets/js/6.792ce084.js"><link rel="prefetch" href="/assets/js/60.9ab8e458.js"><link rel="prefetch" href="/assets/js/61.b3abbf87.js"><link rel="prefetch" href="/assets/js/62.2bde1ed2.js"><link rel="prefetch" href="/assets/js/63.39cf6423.js"><link rel="prefetch" href="/assets/js/64.c839079e.js"><link rel="prefetch" href="/assets/js/65.ea1754c1.js"><link rel="prefetch" href="/assets/js/66.802ec528.js"><link rel="prefetch" href="/assets/js/67.a30d6fff.js"><link rel="prefetch" href="/assets/js/68.d98ac090.js"><link rel="prefetch" href="/assets/js/69.083b1217.js"><link rel="prefetch" href="/assets/js/7.3964fa52.js"><link rel="prefetch" href="/assets/js/70.272720ba.js"><link rel="prefetch" href="/assets/js/71.386b54d7.js"><link rel="prefetch" href="/assets/js/72.005e615f.js"><link rel="prefetch" href="/assets/js/73.b1266355.js"><link rel="prefetch" href="/assets/js/74.9ab08f58.js"><link rel="prefetch" href="/assets/js/75.eefe4ff0.js"><link rel="prefetch" href="/assets/js/76.e4162716.js"><link rel="prefetch" href="/assets/js/77.e1ead4d7.js"><link rel="prefetch" href="/assets/js/78.ae9b9cc3.js"><link rel="prefetch" href="/assets/js/79.eeaf4627.js"><link rel="prefetch" href="/assets/js/8.5ccbfc45.js"><link rel="prefetch" href="/assets/js/80.0272858c.js"><link rel="prefetch" href="/assets/js/81.bbc0907f.js"><link rel="prefetch" href="/assets/js/82.4de7fcc4.js"><link rel="prefetch" href="/assets/js/83.2ad342e1.js"><link rel="prefetch" href="/assets/js/84.3398b3bb.js"><link rel="prefetch" href="/assets/js/85.be446d7c.js"><link rel="prefetch" href="/assets/js/86.1ef2094d.js"><link rel="prefetch" href="/assets/js/87.53795a29.js"><link rel="prefetch" href="/assets/js/88.1c3ba029.js"><link rel="prefetch" href="/assets/js/89.a4797bc8.js"><link rel="prefetch" href="/assets/js/9.1e695694.js"><link rel="prefetch" href="/assets/js/90.12ceffe8.js"><link rel="prefetch" href="/assets/js/91.40c9fc92.js"><link rel="prefetch" href="/assets/js/92.9648154b.js"><link rel="prefetch" href="/assets/js/93.d4e90cec.js"><link rel="prefetch" href="/assets/js/94.50b5eb64.js"><link rel="prefetch" href="/assets/js/95.9d54c125.js"><link rel="prefetch" href="/assets/js/96.fce496cb.js"><link rel="prefetch" href="/assets/js/97.86a56b4e.js"><link rel="prefetch" href="/assets/js/98.cf20fa6d.js"><link rel="prefetch" href="/assets/js/99.92c0c3e3.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a5323663.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">LIANYONGXING. BLOG</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/index.html" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Blog" class="dropdown-title"><span class="title">Blog</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/NLP/" class="nav-link">
  NLP
</a></li><li class="dropdown-item"><!----> <a href="/blog/machineLearning/" class="nav-link">
  MachineLearning
</a></li><li class="dropdown-item"><!----> <a href="/blog/Papers/" class="nav-link">
  Papers
</a></li><li class="dropdown-item"><!----> <a href="/blog/recommenderSystem/" class="nav-link">
  RecommenderSystem
</a></li><li class="dropdown-item"><!----> <a href="/blog/ObjectDetection/" class="nav-link">
  ObjectDetection
</a></li><li class="dropdown-item"><!----> <a href="/blog/os/" class="nav-link router-link-active">
  OperatorSystem
</a></li><li class="dropdown-item"><!----> <a href="/blog/cookies/" class="nav-link">
  Cookies
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/lianyongxing" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/about/" class="nav-link">
  About
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/index.html" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Blog" class="dropdown-title"><span class="title">Blog</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/NLP/" class="nav-link">
  NLP
</a></li><li class="dropdown-item"><!----> <a href="/blog/machineLearning/" class="nav-link">
  MachineLearning
</a></li><li class="dropdown-item"><!----> <a href="/blog/Papers/" class="nav-link">
  Papers
</a></li><li class="dropdown-item"><!----> <a href="/blog/recommenderSystem/" class="nav-link">
  RecommenderSystem
</a></li><li class="dropdown-item"><!----> <a href="/blog/ObjectDetection/" class="nav-link">
  ObjectDetection
</a></li><li class="dropdown-item"><!----> <a href="/blog/os/" class="nav-link router-link-active">
  OperatorSystem
</a></li><li class="dropdown-item"><!----> <a href="/blog/cookies/" class="nav-link">
  Cookies
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/lianyongxing" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/about/" class="nav-link">
  About
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/blog/os/" class="sidebar-link">概述</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>分时操作系统</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>操作系统的逻辑结构</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>操作系统用户界面</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>死锁</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>进程调度</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>内存管理之一</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>内存管理之二</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/os/内存管理/内存管理（2）.html" class="active sidebar-link">内存管理之二</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/os/内存管理/内存管理（2）.html#虚拟内存管理" class="sidebar-link">虚拟内存管理</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>内存管理之三</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>设备管理</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>文件管理</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="内存管理之二"><a href="#内存管理之二" class="header-anchor">#</a> 内存管理之二</h1> <h2 id="虚拟内存管理"><a href="#虚拟内存管理" class="header-anchor">#</a> 虚拟内存管理</h2> <p>上文提到物理内存管理，但是物理内存管理有以下几个缺陷：</p> <ol><li>由于源程序直接使用物理内存地址，程序间容易访问冲突</li> <li>由于程序必须全部装入内存才能运行，内存太小的话程序无法运行</li> <li>由于程序占用连续一片内存，容易产生内存碎片</li> <li>多程序同时运行容易互相干扰，因此不安全</li></ol> <p>相应介绍了几种改善物理内存管理的相关技术：</p> <ul><li>内存拼接</li> <li>对换技术</li> <li>覆盖技术</li></ul> <h3 id="目标"><a href="#目标" class="header-anchor">#</a> 目标</h3> <ul><li>使得大的程序在较小的内存中运行</li> <li>使得多个程序能在较小的内存中运行</li> <li>多个程序并发运行时地址不冲突</li> <li>使得内存利用效率高，无碎片，易共享</li></ul> <h3 id="实现思路"><a href="#实现思路" class="header-anchor">#</a> 实现思路</h3> <p>在程序运行时，只把当前必要的很小的一部分代码和数据装入内存中，其他代码当必要使用时再装入，不再运行的代码和数据及时从内存中删除。实际内存中很容易满足上述的内存需求</p> <h3 id="页式虚拟存储管理"><a href="#页式虚拟存储管理" class="header-anchor">#</a> 页式虚拟存储管理</h3> <h4 id="基础概念"><a href="#基础概念" class="header-anchor">#</a> 基础概念</h4> <p>把进程空间和内存空间划分成等大小的小片，如1k、2k或4k等等。</p> <ul><li>页：进程的小片（虚拟页或页面）</li> <li>页框：内存的小片（物理页）<br>
内存以页框为单位来分配使用，进程以页为单位装入内存
<ul><li>只把程序的部分页装入内存便可运行</li> <li>页在内存中占用的页框不必相邻</li> <li>需要新页时，按需从硬盘调入内存</li> <li>不再运行的页及时删除，腾出空间</li></ul></li></ul> <h4 id="页表和页式地址映射"><a href="#页表和页式地址映射" class="header-anchor">#</a> 页表和页式地址映射</h4> <ol><li>虚拟地址（<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>V</mi><mi>A</mi></mrow><annotation encoding="application/x-tex">VA</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.22222em;">V</span><span class="mord mathit">A</span></span></span></span>）可以分为页号<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.13889em;">P</span></span></span></span>和页内偏移<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>W</mi></mrow><annotation encoding="application/x-tex">W</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.13889em;">W</span></span></span></span> <ul><li>页号<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>(</mo><mi>P</mi><mo>)</mo><mo>:</mo><mi>V</mi><mi>A</mi></mrow><annotation encoding="application/x-tex">(P):VA</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.13889em;">P</span><span class="mclose">)</span><span class="mrel">:</span><span class="mord mathit" style="margin-right:0.22222em;">V</span><span class="mord mathit">A</span></span></span></span>所处的页的编号 = <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>V</mi><mi>A</mi></mrow><annotation encoding="application/x-tex">VA</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.22222em;">V</span><span class="mord mathit">A</span></span></span></span> / 页的大小</li> <li>页内偏移<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>(</mo><mi>W</mi><mo>)</mo><mo>:</mo><mi>V</mi><mi>A</mi></mrow><annotation encoding="application/x-tex">(W):VA</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.13889em;">W</span><span class="mclose">)</span><span class="mrel">:</span><span class="mord mathit" style="margin-right:0.22222em;">V</span><span class="mord mathit">A</span></span></span></span> % 页的大小</li></ul></li></ol> <p>例子：<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>V</mi><mi>A</mi><mo>=</mo><mn>2</mn><mn>5</mn><mn>0</mn><mn>0</mn></mrow><annotation encoding="application/x-tex">VA = 2500</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.22222em;">V</span><span class="mord mathit">A</span><span class="mrel">=</span><span class="mord mathrm">2</span><span class="mord mathrm">5</span><span class="mord mathrm">0</span><span class="mord mathrm">0</span></span></span></span>；页面大小<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn><mi>K</mi><mo>(</mo><mn>1</mn><msup><mn>0</mn><mrow><mn>1</mn><mn>2</mn></mrow></msup><mo>)</mo></mrow><annotation encoding="application/x-tex">1K(10^{12})</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.8141079999999999em;"></span><span class="strut bottom" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">1</span><span class="mord mathit" style="margin-right:0.07153em;">K</span><span class="mopen">(</span><span class="mord mathrm">1</span><span class="mord"><span class="mord mathrm">0</span><span class="vlist"><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathrm">1</span><span class="mord mathrm">2</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">)</span></span></span></span></p> <p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>P</mi><mo>=</mo><mn>2</mn><mn>5</mn><mn>0</mn><mn>0</mn><mi mathvariant="normal">/</mi><mn>1</mn><mn>0</mn><mn>2</mn><mn>4</mn><mo>=</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">P = 2500 / 1024 = 2
</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord mathit" style="margin-right:0.13889em;">P</span><span class="mrel">=</span><span class="mord mathrm">2</span><span class="mord mathrm">5</span><span class="mord mathrm">0</span><span class="mord mathrm">0</span><span class="mord mathrm">/</span><span class="mord mathrm">1</span><span class="mord mathrm">0</span><span class="mord mathrm">2</span><span class="mord mathrm">4</span><span class="mrel">=</span><span class="mord mathrm">2</span></span></span></span></span></p> <p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>W</mi><mo>=</mo><mn>2</mn><mn>5</mn><mn>0</mn><mn>0</mn><mi mathvariant="normal">%</mi><mn>1</mn><mn>0</mn><mn>2</mn><mn>4</mn><mo>=</mo><mn>4</mn><mn>5</mn><mn>2</mn></mrow><annotation encoding="application/x-tex">W = 2500 \% 1024 = 452
</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:0.80556em;vertical-align:-0.05556em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord mathit" style="margin-right:0.13889em;">W</span><span class="mrel">=</span><span class="mord mathrm">2</span><span class="mord mathrm">5</span><span class="mord mathrm">0</span><span class="mord mathrm">0</span><span class="mord mathrm">%</span><span class="mord mathrm">1</span><span class="mord mathrm">0</span><span class="mord mathrm">2</span><span class="mord mathrm">4</span><span class="mrel">=</span><span class="mord mathrm">4</span><span class="mord mathrm">5</span><span class="mord mathrm">2</span></span></span></span></span></p> <ol start="2"><li>实际计算机中，CPU运行乘除法很慢，因此真正计算的时候是（比如页的大小为<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mi>n</mi></msup></mrow><annotation encoding="application/x-tex">2^n</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.664392em;"></span><span class="strut bottom" style="height:0.664392em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathrm">2</span><span class="vlist"><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathit">n</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>单元）：
<ul><li>页号<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>P</mi><mo>=</mo><mi>V</mi><mi>A</mi><mo>&gt;</mo><mo>&gt;</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">P = VA &gt;&gt; n</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.72243em;vertical-align:-0.0391em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.13889em;">P</span><span class="mrel">=</span><span class="mord mathit" style="margin-right:0.22222em;">V</span><span class="mord mathit">A</span><span class="mrel">&gt;</span><span class="mrel">&gt;</span><span class="mord mathit">n</span></span></span></span></li> <li>页内偏移<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>W</mi><mo>=</mo></mrow><annotation encoding="application/x-tex">W =</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.13889em;">W</span><span class="mrel">=</span></span></span></span> 低<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">n</span></span></span></span>位  <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>=</mo><mrow><mi>V</mi><mi>A</mi></mrow><mi mathvariant="normal">&amp;</mi><mi mathvariant="normal">&amp;</mi><mo>(</mo><msup><mn>2</mn><mi>n</mi></msup><mo>−</mo><mn>1</mn><mo>)</mo></mrow><annotation encoding="application/x-tex">={VA}  \&amp;\&amp; (2^n - 1)</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mrel">=</span><span class="mord textstyle uncramped"><span class="mord mathit" style="margin-right:0.22222em;">V</span><span class="mord mathit">A</span></span><span class="mord mathrm">&amp;</span><span class="mord mathrm">&amp;</span><span class="mopen">(</span><span class="mord"><span class="mord mathrm">2</span><span class="vlist"><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathit">n</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">−</span><span class="mord mathrm">1</span><span class="mclose">)</span></span></span></span></li></ul></li> <li>页表记录页与页框之间的对应关系</li></ol> <table><thead><tr><th>页号</th> <th>页框号</th> <th>页面其他特性</th></tr></thead> <tbody><tr><td>0</td> <td>5</td> <td>……</td></tr> <tr><td>1</td> <td>65</td> <td>……</td></tr> <tr><td>2</td> <td>13</td> <td>……</td></tr></tbody></table> <ul><li>页号：登记程序地址的页号</li> <li>页框号：登记页所在的物理页号</li> <li>页面其他特性：登记含存取权限在内的其他特性</li></ul> <h4 id="页式地址映射"><a href="#页式地址映射" class="header-anchor">#</a> 页式地址映射</h4> <p>从一个虚拟地址（页式地址）——&gt; 物理地址</p> <p>分为三步：</p> <ol><li>从<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>V</mi><mi>A</mi></mrow><annotation encoding="application/x-tex">VA</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.22222em;">V</span><span class="mord mathit">A</span></span></span></span>分离页号<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.13889em;">P</span></span></span></span>和页内偏移<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>W</mi></mrow><annotation encoding="application/x-tex">W</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.13889em;">W</span></span></span></span></li> <li>查页表：以<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.13889em;">P</span></span></span></span>为索引查页框号<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>P</mi><mrow><msup><mrow></mrow><mrow><mi mathvariant="normal">′</mi></mrow></msup></mrow></msup></mrow><annotation encoding="application/x-tex">P^{'}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.89488em;"></span><span class="strut bottom" style="height:0.89488em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">P</span><span class="vlist"><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord"><span></span><span class="vlist"><span style="top:-0.363em;margin-right:0.07142857142857144em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-scriptstyle scriptscriptstyle uncramped"><span class="mord scriptscriptstyle uncramped"><span class="mord mathrm">′</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></li> <li>计算物理地址<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>M</mi><mi>A</mi></mrow><annotation encoding="application/x-tex">MA</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.10903em;">M</span><span class="mord mathit">A</span></span></span></span></li></ol> <p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>M</mi><mi>A</mi><mo>=</mo><msup><mi>P</mi><mrow><msup><mrow></mrow><mrow><mi mathvariant="normal">′</mi></mrow></msup></mrow></msup><mo>×</mo><mi>P</mi><mi>a</mi><mi>g</mi><mi>e</mi><mi>S</mi><mi>i</mi><mi>z</mi><mi>e</mi><mo>+</mo><mi>W</mi></mrow><annotation encoding="application/x-tex">MA = P^{'} \times PageSize+ W 
</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.9448799999999999em;"></span><span class="strut bottom" style="height:1.1393199999999999em;vertical-align:-0.19444em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord mathit" style="margin-right:0.10903em;">M</span><span class="mord mathit">A</span><span class="mrel">=</span><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">P</span><span class="vlist"><span style="top:-0.413em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord"><span></span><span class="vlist"><span style="top:-0.363em;margin-right:0.07142857142857144em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-scriptstyle scriptscriptstyle uncramped"><span class="mord scriptscriptstyle uncramped"><span class="mord mathrm">′</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">×</span><span class="mord mathit" style="margin-right:0.13889em;">P</span><span class="mord mathit">a</span><span class="mord mathit" style="margin-right:0.03588em;">g</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mord mathit">i</span><span class="mord mathit" style="margin-right:0.04398em;">z</span><span class="mord mathit">e</span><span class="mbin">+</span><span class="mord mathit" style="margin-right:0.13889em;">W</span></span></span></span></span></p> <div align="center"><img src="/assets/img/49035EDE-A7DA-49FF-A76E-52E06536AE55.5b07ddce.png" width="60%" height="60%" alt="图片名称"></div> <h4 id="快表技术（cache）"><a href="#快表技术（cache）" class="header-anchor">#</a> 快表技术（Cache）</h4> <p>快表：页表放在cache中；慢表：页表放在内存中</p> <ul><li>快表容量小，访问快，成本高。</li> <li>快表是慢表的部分内容的复制。</li> <li>地址映射时优先访问快表。</li></ul> <p>如果在快表中找到了所需的数据，就称为“命中”，没有命中时，需要访问慢表，同时更新快表。</p> <p>合理的页面调度策略能使快表具有较高命中率。</p> <div align="center"><img src="/assets/img/7AC00E01-1F0E-442B-AB0A-82B3200C1DA1.e81e7bb8.png" width="50%" height="50%" alt="图片名称"></div> <h4 id="页面共享技术"><a href="#页面共享技术" class="header-anchor">#</a> 页面共享技术</h4> <p>代码共享的例子：<br>
文本编辑器占用多少内存？<br>
文本编辑器代码占用150KB和数据占用50KB<br>
有10进程并发执行该文本编辑器。</p> <ol><li>常规占用内存为</li></ol> <p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn><mn>0</mn><mo>×</mo><mo>(</mo><mn>1</mn><mn>5</mn><mn>0</mn><mo>+</mo><mn>5</mn><mn>0</mn><mo>)</mo><mi>K</mi><mi>B</mi><mo>=</mo><mn>2</mn><mi>M</mi></mrow><annotation encoding="application/x-tex">10 \times(150 + 50) KB = 2M
</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord mathrm">1</span><span class="mord mathrm">0</span><span class="mbin">×</span><span class="mopen">(</span><span class="mord mathrm">1</span><span class="mord mathrm">5</span><span class="mord mathrm">0</span><span class="mbin">+</span><span class="mord mathrm">5</span><span class="mord mathrm">0</span><span class="mclose">)</span><span class="mord mathit" style="margin-right:0.07153em;">K</span><span class="mord mathit" style="margin-right:0.05017em;">B</span><span class="mrel">=</span><span class="mord mathrm">2</span><span class="mord mathit" style="margin-right:0.10903em;">M</span></span></span></span></span></p> <ol start="2"><li>如果采用代码段共享，代码段在内存只有一份真实存储，占用内存为</li></ol> <p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn><mn>5</mn><mn>0</mn><mo>+</mo><mn>1</mn><mn>0</mn><mo>×</mo><mn>5</mn><mn>0</mn><mo>=</mo><mn>6</mn><mn>5</mn><mn>0</mn><mi>K</mi><mi>B</mi></mrow><annotation encoding="application/x-tex">150 + 10 \times 50 = 650KB
</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord mathrm">1</span><span class="mord mathrm">5</span><span class="mord mathrm">0</span><span class="mbin">+</span><span class="mord mathrm">1</span><span class="mord mathrm">0</span><span class="mbin">×</span><span class="mord mathrm">5</span><span class="mord mathrm">0</span><span class="mrel">=</span><span class="mord mathrm">6</span><span class="mord mathrm">5</span><span class="mord mathrm">0</span><span class="mord mathit" style="margin-right:0.07153em;">K</span><span class="mord mathit" style="margin-right:0.05017em;">B</span></span></span></span></span></p> <ul><li>实现原理
<ul><li>在不同进程的页表中填入相同的页框号，多个进程就能访问相同的内存空间，从而实现页面共享。</li> <li>共享页面在内存只有一份真实存储，节省内存。</li></ul></li></ul> <div align="center"><img src="/assets/img/84535976-5DBB-48E2-AB7F-061C19B0C7F9.cc7ad037.png" width="50%" height="50%" alt="图片名称"></div> <h4 id="缺页中断"><a href="#缺页中断" class="header-anchor">#</a> 缺页中断</h4> <p>现在操作系统中为三级存储体系，如果CPU所需的内容在Cache中，就称为命中，没有命中的话会从内存中进行获取，并将内容更新到cache中，如果主存中也不存在的话（因为只有一小部分程序会在内存中），则去辅存中寻找，这个过程称为<u>缺页</u>。</p> <p>定义：在地址映射过程中，当所要访问的目的页不在内存中时，则系统产生异常中断——缺页中断。</p> <p>缺页中断处理程序：中断处理程序把所缺的页草页表指出的辅存地址调入内存的某个页框中，并更新页表中该页对应的页框号以及修改中断位为0。</p> <h4 id="页表扩充-带中断位的页表"><a href="#页表扩充-带中断位的页表" class="header-anchor">#</a> 页表扩充——带中断位的页表</h4> <table><thead><tr><th>页号</th> <th>页框号</th> <th>中断位I</th> <th>辅存地址</th></tr></thead> <tbody><tr><td></td> <td></td> <td>0</td> <td></td></tr> <tr><td></td> <td></td> <td>1</td> <td></td></tr></tbody></table> <p>其中中断位I——表示该页是否在内存中。</p> <ul><li>如果 I = 1，不在内存</li> <li>如果 I = 0，在内存中</li></ul> <p>辅存地址，该页在辅存中的地址</p> <h4 id="页表扩充-带中断位的页表-2"><a href="#页表扩充-带中断位的页表-2" class="header-anchor">#</a> 页表扩充——带中断位的页表</h4> <table><thead><tr><th>页号</th> <th>页框号</th> <th>访问位</th> <th>修改位</th></tr></thead> <tbody><tr><td></td> <td></td> <td>1</td> <td>0</td></tr> <tr><td></td> <td></td> <td>0</td> <td>1</td></tr></tbody></table> <p>访问位——标识该页是否最近被访问；修改位——标识该页是否已被修改。<br> <img src="/assets/img/59DD37C0-398C-408F-AC99-77670E31AECD.641f2a63.png" alt="641f2a63266fbad982f97d8e957bbc13"></p> <p>缺页率<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi></mrow><annotation encoding="application/x-tex">f</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.10764em;">f</span></span></span></span> = 缺页次数 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">/</mi></mrow><annotation encoding="application/x-tex">/</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">/</span></span></span></span> 访问页面总次数</p> <p>命中率 = <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn><mo>−</mo><mi>f</mi></mrow><annotation encoding="application/x-tex">1 - f</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">1</span><span class="mbin">−</span><span class="mord mathit" style="margin-right:0.10764em;">f</span></span></span></span></p> <h3 id="页面淘汰"><a href="#页面淘汰" class="header-anchor">#</a> 页面淘汰</h3> <p>选择淘汰哪一页的规则称淘汰策略。<br>
一个页面在内存和辅存间频繁交换的现象称为页面抖动。<br>
抖动会导致系统效率下降，因此应该避免。</p> <h5 id="最佳算法（opt算法，optimal）"><a href="#最佳算法（opt算法，optimal）" class="header-anchor">#</a> 最佳算法（OPT算法，Optimal）</h5> <p>思想：淘汰以后不再需要或最远的将来才会用到的页面</p> <p><img src="/assets/img/E2CD525F-A3A3-4A14-B303-2A8FD0179897.3dd0a8ae.png" alt="3dd0a8ae0c2ffd2814f765ffabeea7e7"></p> <p>理论上最佳，实际无法实现，不知道将来要访问什么页</p> <h4 id="先进先出算法（fifo）"><a href="#先进先出算法（fifo）" class="header-anchor">#</a> 先进先出算法（FIFO）</h4> <p>思想：淘汰在内存中停留时间最长的页</p> <p><img src="/assets/img/4CDDEB58-197F-4D3A-8456-D1FC17889364.3a23b81c.png" alt="3a23b81c958deb8e43459dff9fd30d8c"></p> <p>进程只有按照顺序访问地址空间时页面命中率才最理想。<br>
其次，对于一些特定的访问序列，随分配的页框增多，缺页率反而增加。<br> <img src="/assets/img/A7CDDFE9-F360-4391-AE6F-240DF48EB1D5.e9a2cc03.png" alt="e9a2cc03fe9c646d51a35b68539324b6"></p> <h4 id="最久未使用淘汰算法（lru，least-recently-used）"><a href="#最久未使用淘汰算法（lru，least-recently-used）" class="header-anchor">#</a> 最久未使用淘汰算法（LRU，Least Recently Used）</h4> <p>思想：淘汰最长时间未被使用的页面<br> <img src="/assets/img/85DB9845-1836-4CC1-8A99-11C4026CDD7C.745dfbb4.png" alt="745dfbb4d0b1f1220e1e9cb361613abd"></p> <ul><li>LRU算法硬件实现：每个页面设置一个移位寄存器，当页面被访问时则将其重置为1，周期性地将所有页面的R左移1位，后面补0.选择R值最大的把它淘汰掉。</li> <li>LRU软件实现：利用页表的访问位，当页被访问的时候值1，周期性地将所有访问位置0，当淘汰页面时根据访问位来判断淘汰，当访问位为1时，则说明在T时间内，该页被访问过，进行保留；当访问位为0时，则说明在T时间内，该页没有被访问过，淘汰该页。</li></ul> <h4 id="最不经常使用算法（lfu）"><a href="#最不经常使用算法（lfu）" class="header-anchor">#</a> 最不经常使用算法（LFU）</h4> <p>思想：选择到当前为止被访问次数最少的页面，每页设置计数器，当被访问时加1，发生缺页中断，则淘汰数值最小的页面，将所有技术清零。</p> <h4 id="缺页因素分析和页式系统的缺点"><a href="#缺页因素分析和页式系统的缺点" class="header-anchor">#</a> 缺页因素分析和页式系统的缺点</h4> <h5 id="缺页因素"><a href="#缺页因素" class="header-anchor">#</a> 缺页因素</h5> <ul><li>淘汰算法</li> <li>分配给系统的页框数</li> <li>页面本身的大小</li> <li>编程方法</li></ul> <h5 id="页式系统的缺点"><a href="#页式系统的缺点" class="header-anchor">#</a> 页式系统的缺点</h5> <ul><li>页面划分无逻辑含义（以固定大小被强行划分）</li> <li>页面的共享不灵活（以页框为单位共享，有时候共享的代码仅仅是页框内的一部分）</li> <li>页内碎片（如果代码没有充满页面，则有一部分被浪费）</li></ul> <h3 id="段式虚拟存储管理"><a href="#段式虚拟存储管理" class="header-anchor">#</a> 段式虚拟存储管理</h3> <p>进程分段，把进程按照逻辑意义划分为多个段，每段有段名，长度不定，进程由多段组成</p> <div align="center"><img src="/assets/img/CC4112F5-8339-48F9-8EF2-1B58150AC681.bf539ac1.png" width="70%" height="70%" alt="图片名称"></div> <h4 id="内存分配"><a href="#内存分配" class="header-anchor">#</a> 内存分配</h4> <p>段式系统的内存分配：</p> <ul><li>以段位单位装入，每段分配连续的内存</li> <li>但是段和段不要求相邻</li></ul> <h4 id="虚拟内存地址"><a href="#虚拟内存地址" class="header-anchor">#</a> 虚拟内存地址</h4> <p>段式虚拟地址<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>V</mi><mi>A</mi></mrow><annotation encoding="application/x-tex">VA</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.22222em;">V</span><span class="mord mathit">A</span></span></span></span>包含段号<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.05764em;">S</span></span></span></span>和段内偏移<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>W</mi></mrow><annotation encoding="application/x-tex">W</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.13889em;">W</span></span></span></span></p> <h4 id="段式地址的映射机制"><a href="#段式地址的映射机制" class="header-anchor">#</a> 段式地址的映射机制</h4> <p>需要用到<u>段表</u>，记录每段在内存中的映射位置。</p> <table><thead><tr><th>段号</th> <th>段长</th> <th>基地址</th></tr></thead> <tbody><tr><td></td> <td></td> <td></td></tr> <tr><td>S</td> <td>L</td> <td>B</td></tr> <tr><td></td> <td></td> <td></td></tr> <tr><td></td> <td></td> <td></td></tr></tbody></table> <p>段号：段的编号（唯一的）。<br>
段长：该段的长度。<br>
基地址：该段在内存中的首地址。</p> <h5 id="映射过程"><a href="#映射过程" class="header-anchor">#</a> 映射过程</h5> <ol><li>逻辑地址<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>V</mi><mi>A</mi></mrow><annotation encoding="application/x-tex">VA</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.22222em;">V</span><span class="mord mathit">A</span></span></span></span>分离出<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.05764em;">S</span></span></span></span>、<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>W</mi></mrow><annotation encoding="application/x-tex">W</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.13889em;">W</span></span></span></span></li> <li>查询段表：检索段号，查询该段基地址B和长度L</li> <li>物理地址<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>M</mi><mi>A</mi></mrow><annotation encoding="application/x-tex">MA</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.10903em;">M</span><span class="mord mathit">A</span></span></span></span> = <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.05017em;">B</span></span></span></span> + <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>W</mi></mrow><annotation encoding="application/x-tex">W</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.13889em;">W</span></span></span></span></li></ol> <div align="center"><img src="/assets/img/D73CB772-A378-4690-A78C-24B1CF631482.dbc78154.png" width="70%" height="70%" alt="图片名称"></div> <h5 id="段表的扩充"><a href="#段表的扩充" class="header-anchor">#</a> 段表的扩充</h5> <p>类似页表，段表也可以进行扩充</p> <div align="center"><img src="/assets/img/B3DB0788-9AB4-4736-816E-AF25B242DFA0.de8613cb.png" width="70%" height="70%" alt="图片名称"></div> <h5 id="段的共享"><a href="#段的共享" class="header-anchor">#</a> 段的共享</h5> <ul><li>共享段在内存中只有一份存储</li> <li>共享段被多个进程映射到各自的段表</li> <li>需要共享的模块都可以设置为单独的段</li></ul> <h5 id="段式系统的缺点"><a href="#段式系统的缺点" class="header-anchor">#</a> 段式系统的缺点</h5> <ul><li>段需要连续的存储空间</li> <li>段的最大尺寸收到内存大小的限制</li> <li>在辅存中管理可变尺寸的段比较困难</li></ul> <h5 id="段式系统vs页式系统"><a href="#段式系统vs页式系统" class="header-anchor">#</a> 段式系统VS页式系统</h5> <ul><li>页式系统：一维地址空间</li> <li>段式系统：二维地址空间</li></ul> <p>段与页的区别</p> <ol><li>段长可变/页长不可变</li> <li>段的段分有意义/页面无意义</li> <li>段方便共享/页面不方便共享</li> <li>段用户可见/页面用户不可见</li> <li>段偏移有溢出/页面偏移无溢出</li></ol> <h3 id="段页式虚拟存储管理"><a href="#段页式虚拟存储管理" class="header-anchor">#</a> 段页式虚拟存储管理</h3> <p>在段式存储管理中结合页式存储管理（在段中划分页面）<br>
段页式系统地址的构成：段号、页号、页内偏移。</p> <h4 id="段页式的映射机制"><a href="#段页式的映射机制" class="header-anchor">#</a> 段页式的映射机制</h4> <p>同时采用段表和页表实现映射</p> <ul><li>系统为每个进程建立一个段表</li> <li>系统为每个段建立一个页表</li> <li>段表给出每段的页表基地址及页表长度（段长）</li> <li>页表给出每页对应的页框</li></ul> <div align="center"><img src="/assets/img/7E3A355B-C985-4D53-B9AF-1AEF77757F01.934c8179.png" width="70%" height="70%" alt="图片名称"></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/os/内存管理/内存管理（1）.html" class="prev">
        内存管理之一
      </a></span> <span class="next"><a href="/blog/os/内存管理/内存管理（3）.html">
        内存管理之三
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.acaacfed.js" defer></script><script src="/assets/js/2.858fe96a.js" defer></script><script src="/assets/js/5.55c31470.js" defer></script>
  </body>
</html>
