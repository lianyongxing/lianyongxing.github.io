(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{379:function(t,s,a){t.exports=a.p+"assets/img/Untitled.eb7fca31.png"},380:function(t,s,a){t.exports=a.p+"assets/img/Untitled1.797a6eec.png"},381:function(t,s,a){t.exports=a.p+"assets/img/Untitled2.52707305.png"},382:function(t,s,a){t.exports=a.p+"assets/img/Untitled3.2dbc101d.png"},383:function(t,s,a){t.exports=a.p+"assets/img/Untitled4.5625a9c0.png"},384:function(t,s,a){t.exports=a.p+"assets/img/Untitled5.8337299d.png"},385:function(t,s,a){t.exports=a.p+"assets/img/Untitled6.2f14e309.png"},386:function(t,s,a){t.exports=a.p+"assets/img/Untitled7.49ae2345.png"},387:function(t,s,a){t.exports=a.p+"assets/img/Untitled8.edd650a9.png"},388:function(t,s,a){t.exports=a.p+"assets/img/Untitled9.040d65a9.png"},640:function(t,s,a){"use strict";a.r(s);var n=a(44),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"long-short-term-memory"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#long-short-term-memory"}},[t._v("#")]),t._v(" Long Short Term Memory")]),t._v(" "),n("h2",{attrs:{id:"simple-rnn"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#simple-rnn"}},[t._v("#")]),t._v(" Simple RNN")]),t._v(" "),n("p",[n("span",{staticClass:"katex-display"},[n("span",{staticClass:"katex"},[n("span",{staticClass:"katex-mathml"},[n("math",[n("semantics",[n("mrow",[n("mi",[t._v("y")]),n("mo",[t._v("(")]),n("mi",[t._v("t")]),n("mo",[t._v(")")]),n("mo",[t._v("=")]),n("mi",[t._v("f")]),n("mo",[t._v("(")]),n("mi",[t._v("X")]),n("mo",[t._v("(")]),n("mi",[t._v("t")]),n("mo",[t._v(")")]),n("mo",[t._v("∗")]),n("mi",[t._v("W")]),n("mo",[t._v("+")]),n("mi",[t._v("y")]),n("mo",[t._v("(")]),n("mi",[t._v("t")]),n("mo",[t._v("−")]),n("mn",[t._v("1")]),n("mo",[t._v(")")]),n("mo",[t._v("∗")]),n("mi",[t._v("V")]),n("mo",[t._v("+")]),n("mi",[t._v("b")]),n("mo",[t._v(")")])],1),n("annotation",{attrs:{encoding:"application/x-tex"}},[t._v("y(t)=f(X(t)*W +y(t-1)*V+b)\n")])],1)],1)],1),n("span",{staticClass:"katex-html",attrs:{"aria-hidden":"true"}},[n("span",{staticClass:"strut",staticStyle:{height:"0.75em"}}),n("span",{staticClass:"strut bottom",staticStyle:{height:"1em","vertical-align":"-0.25em"}}),n("span",{staticClass:"base displaystyle textstyle uncramped"},[n("span",{staticClass:"mord mathit",staticStyle:{"margin-right":"0.03588em"}},[t._v("y")]),n("span",{staticClass:"mopen"},[t._v("(")]),n("span",{staticClass:"mord mathit"},[t._v("t")]),n("span",{staticClass:"mclose"},[t._v(")")]),n("span",{staticClass:"mrel"},[t._v("=")]),n("span",{staticClass:"mord mathit",staticStyle:{"margin-right":"0.10764em"}},[t._v("f")]),n("span",{staticClass:"mopen"},[t._v("(")]),n("span",{staticClass:"mord mathit",staticStyle:{"margin-right":"0.07847em"}},[t._v("X")]),n("span",{staticClass:"mopen"},[t._v("(")]),n("span",{staticClass:"mord mathit"},[t._v("t")]),n("span",{staticClass:"mclose"},[t._v(")")]),n("span",{staticClass:"mbin"},[t._v("∗")]),n("span",{staticClass:"mord mathit",staticStyle:{"margin-right":"0.13889em"}},[t._v("W")]),n("span",{staticClass:"mbin"},[t._v("+")]),n("span",{staticClass:"mord mathit",staticStyle:{"margin-right":"0.03588em"}},[t._v("y")]),n("span",{staticClass:"mopen"},[t._v("(")]),n("span",{staticClass:"mord mathit"},[t._v("t")]),n("span",{staticClass:"mbin"},[t._v("−")]),n("span",{staticClass:"mord mathrm"},[t._v("1")]),n("span",{staticClass:"mclose"},[t._v(")")]),n("span",{staticClass:"mbin"},[t._v("∗")]),n("span",{staticClass:"mord mathit",staticStyle:{"margin-right":"0.22222em"}},[t._v("V")]),n("span",{staticClass:"mbin"},[t._v("+")]),n("span",{staticClass:"mord mathit"},[t._v("b")]),n("span",{staticClass:"mclose"},[t._v(")")])])])])])]),t._v(" "),n("p",[t._v("无隐藏层的循环神经网络，每个时刻的决策都依赖上一个时刻的决策结果。"),n("br"),t._v("\n但是，新的知识不是直接加上上一时刻的知识，而是加上一个通过隐藏层后更加模糊宏观的知识，将这个定义为神经网络中的隐节点"),n("span",{staticClass:"katex"},[n("span",{staticClass:"katex-mathml"},[n("math",[n("semantics",[n("mrow",[n("mi",[t._v("h")])],1),n("annotation",{attrs:{encoding:"application/x-tex"}},[t._v("h")])],1)],1)],1),n("span",{staticClass:"katex-html",attrs:{"aria-hidden":"true"}},[n("span",{staticClass:"strut",staticStyle:{height:"0.69444em"}}),n("span",{staticClass:"strut bottom",staticStyle:{height:"0.69444em","vertical-align":"0em"}}),n("span",{staticClass:"base textstyle uncramped"},[n("span",{staticClass:"mord mathit"},[t._v("h")])])])]),t._v("，也就是说，潜意识里直接利用的是一段记忆融合后的东西"),n("span",{staticClass:"katex"},[n("span",{staticClass:"katex-mathml"},[n("math",[n("semantics",[n("mrow",[n("mi",[t._v("h")])],1),n("annotation",{attrs:{encoding:"application/x-tex"}},[t._v("h")])],1)],1)],1),n("span",{staticClass:"katex-html",attrs:{"aria-hidden":"true"}},[n("span",{staticClass:"strut",staticStyle:{height:"0.69444em"}}),n("span",{staticClass:"strut bottom",staticStyle:{height:"0.69444em","vertical-align":"0em"}}),n("span",{staticClass:"base textstyle uncramped"},[n("span",{staticClass:"mord mathit"},[t._v("h")])])])]),t._v("，而不单单是上一时间点的输出，这种加入隐藏层的RNN就是经典的RNN，如下图所示"),n("br")]),n("div",{attrs:{align:"center"}},[n("br"),t._v(" "),n("img",{attrs:{src:a(379),width:"80%"}}),n("br")]),n("br"),t._v("\n但是，存在隐藏层的RNN，由于误差反向传播，梯度会容易发生指数级别的衰减或者放大"),n("p"),t._v(" "),n("p",[t._v("因此RNN的记忆单元是短时的")]),t._v(" "),n("div",{attrs:{align:"center"}},[n("img",{attrs:{src:a(380),width:"80%"}})]),t._v(" "),n("h2",{attrs:{id:"lstm-长短期记忆"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#lstm-长短期记忆"}},[t._v("#")]),t._v(" LSTM—长短期记忆")]),t._v(" "),n("h3",{attrs:{id:"整体架构"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#整体架构"}},[t._v("#")]),t._v(" 整体架构")]),t._v(" "),n("div",{attrs:{align:"center"}},[n("img",{attrs:{src:a(381),width:"110%"}})]),t._v("\nlstm引入了长短期记忆模块来解决RNN梯度消失或者爆炸问题，主要包括遗忘门、输入门、输出门\n"),n("p",[t._v("实际上是在RNN的基础上加了一个“日记本”，即长期记忆"),n("span",{staticClass:"katex"},[n("span",{staticClass:"katex-mathml"},[n("math",[n("semantics",[n("mrow",[n("mi",[t._v("c")])],1),n("annotation",{attrs:{encoding:"application/x-tex"}},[t._v("c")])],1)],1)],1),n("span",{staticClass:"katex-html",attrs:{"aria-hidden":"true"}},[n("span",{staticClass:"strut",staticStyle:{height:"0.43056em"}}),n("span",{staticClass:"strut bottom",staticStyle:{height:"0.43056em","vertical-align":"0em"}}),n("span",{staticClass:"base textstyle uncramped"},[n("span",{staticClass:"mord mathit"},[t._v("c")])])])])]),t._v(" "),n("div",{attrs:{align:"center"}},[n("img",{attrs:{src:a(382),width:"80%"}})]),t._v(" "),n("h3",{attrs:{id:"遗忘门"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#遗忘门"}},[t._v("#")]),t._v(" 遗忘门")]),t._v(" "),n("div",{attrs:{align:"center"}},[n("img",{attrs:{src:a(383),width:"100%"}})]),t._v("\n遗忘门将输入信息和隐藏层信息整合，然后结合整合后的信息对长期记忆中的信息选择性遗忘；\n"),n("h3",{attrs:{id:"输入门"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#输入门"}},[t._v("#")]),t._v(" 输入门")]),t._v(" "),n("div",{attrs:{align:"center"}},[n("img",{attrs:{src:a(384),width:"100%"}})]),t._v("\n输入门利用整合后的信息选择性得写入信息到长期记忆中；\n"),n("h3",{attrs:{id:"输出门"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#输出门"}},[t._v("#")]),t._v(" 输出门")]),t._v(" "),n("div",{attrs:{align:"center"}},[n("img",{attrs:{src:a(385),width:"100%"}})]),t._v("\n输出门结合长期和短期记忆，输出最终结果\n"),n("h3",{attrs:{id:"公式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#公式"}},[t._v("#")]),t._v(" 公式")]),t._v(" "),n("div",{attrs:{align:"center"}},[n("img",{attrs:{src:a(386),width:"40%"}})]),t._v(" "),n("h3",{attrs:{id:"代码"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#代码"}},[t._v("#")]),t._v(" 代码")]),t._v(" "),n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("LSTM")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("nn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Module"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("__init__")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" input_size"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" hidden_size"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("super")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("LSTM"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("__init__"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("input_size "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" input_size\n        self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hidden_size "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" hidden_size\n\n\t\t\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 输入门")]),t._v("\n        self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("U_i "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" nn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Linear"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("input_size"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hidden_size"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("V_i "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" nn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Linear"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hidden_size"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hidden_size"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 遗忘门")]),t._v("\n        self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("U_f "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" nn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Linear"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("input_size"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hidden_size"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("V_f "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" nn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Linear"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hidden_size"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hidden_size"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 长期记忆")]),t._v("\n        self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("U_c "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" nn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Linear"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("input_size"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hidden_size"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("V_c "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" nn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Linear"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hidden_size"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hidden_size"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 输出门")]),t._v("\n        self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("U_o "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" nn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Linear"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("input_size"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hidden_size"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("V_o "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" nn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Linear"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hidden_size"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hidden_size"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("forward")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" x"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" init_states"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("None")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        batch_size"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" seq_len"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" n_dim "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" x"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("size"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        hidden_state "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" init_states "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("is")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("None")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            h_t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" c_t "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n                torch"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("zeros"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("batch_size"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hidden_size"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                torch"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("zeros"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("batch_size"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hidden_size"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            h_t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" c_t "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" init_states\n\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" t "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("range")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("seq_len"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            x_t "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" x"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 每时刻输入为当前的单词")]),t._v("\n            i_t "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" torch"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sigmoid"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("U_i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x_t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("V_i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("h_t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            f_t "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" torch"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sigmoid"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("U_f"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x_t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("V_f"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("h_t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            g_t "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" torch"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tanh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("U_c"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x_t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("V_c"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("h_t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            o_t "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" torch"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sigmoid"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("U_o"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x_t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("V_o"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("h_t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            c_t "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" f_t "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" c_t "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" i_t "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" g_t\n            h_t "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" o_t "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" torch"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tanh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("c_t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n            hidden_state"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("append"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("h_t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("unsqueeze"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        hidden_state "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" torch"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cat"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("hidden_state"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" dim"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        hidden_state "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" hidden_state"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("transpose"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("contiguous"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" hidden_state"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("h_t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" c_t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("h3",{attrs:{id:"注意"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#注意"}},[t._v("#")]),t._v(" 注意")]),t._v(" "),n("ol",[n("li",[t._v("LSTM按时间维度展开，实际上是3维模型")])]),t._v(" "),n("div",{attrs:{align:"center"}},[n("img",{attrs:{src:a(387),width:"90%"}})]),t._v("\n2. LSTM的时间长度是输入数据的长度，即时间步（从代码可以看出）\n"),n("ol",{attrs:{start:"3"}},[n("li",[n("p",[t._v("每个时间步，输入为当时的单个字符（从代码可以看出），之前的信息都在长期记忆中")])]),t._v(" "),n("li",[n("p",[t._v("上图为1个LSTMCell，只是把时间步展开了")])]),t._v(" "),n("li",[n("p",[t._v("整个计算过程如下图")])])]),t._v(" "),n("div",{attrs:{align:"center"}},[n("img",{attrs:{src:a(388),width:"90%"}})])])}),[],!1,null,null,null);s.default=e.exports}}]);