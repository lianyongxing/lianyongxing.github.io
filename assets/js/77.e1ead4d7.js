(window.webpackJsonp=window.webpackJsonp||[]).push([[77],{646:function(t,s,a){"use strict";a.r(s);var i=a(44),e=Object(i.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"fgsm→fgm→pgd"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#fgsm→fgm→pgd"}},[t._v("#")]),t._v(" FGSM→FGM→PGD")]),t._v(" "),a("h3",{attrs:{id:"原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#原理"}},[t._v("#")]),t._v(" 原理")]),t._v(" "),a("p",[t._v("深度学习通过梯度下降更新模型参数，因此有")]),t._v(" "),a("p",[a("span",{staticClass:"katex-display"},[a("span",{staticClass:"katex"},[a("span",{staticClass:"katex-mathml"},[a("math",[a("semantics",[a("mrow",[a("mi",[t._v("w")]),a("mi",[t._v("e")]),a("mi",[t._v("i")]),a("mi",[t._v("g")]),a("mi",[t._v("h")]),a("msub",[a("mi",[t._v("t")]),a("mrow",[a("mi",[t._v("n")]),a("mi",[t._v("e")]),a("mi",[t._v("w")])],1)],1),a("mo",[t._v("=")]),a("mi",[t._v("w")]),a("mi",[t._v("e")]),a("mi",[t._v("i")]),a("mi",[t._v("g")]),a("mi",[t._v("h")]),a("msub",[a("mi",[t._v("t")]),a("mrow",[a("mi",[t._v("o")]),a("mi",[t._v("l")]),a("mi",[t._v("d")])],1)],1),a("mo",[t._v("−")]),a("mi",[t._v("l")]),a("mi",[t._v("r")]),a("mo",[t._v("∗")]),a("mi",[t._v("g")]),a("mi",[t._v("r")]),a("mi",[t._v("a")]),a("mi",[t._v("d")]),a("mi",[t._v("i")]),a("mi",[t._v("e")]),a("mi",[t._v("n")]),a("mi",[t._v("t")]),a("mi",[t._v("s")])],1),a("annotation",{attrs:{encoding:"application/x-tex"}},[t._v("weight_{new} = weight_{old}-lr*gradients\n")])],1)],1)],1),a("span",{staticClass:"katex-html",attrs:{"aria-hidden":"true"}},[a("span",{staticClass:"strut",staticStyle:{height:"0.69444em"}}),a("span",{staticClass:"strut bottom",staticStyle:{height:"0.8888799999999999em","vertical-align":"-0.19444em"}}),a("span",{staticClass:"base displaystyle textstyle uncramped"},[a("span",{staticClass:"mord mathit",staticStyle:{"margin-right":"0.02691em"}},[t._v("w")]),a("span",{staticClass:"mord mathit"},[t._v("e")]),a("span",{staticClass:"mord mathit"},[t._v("i")]),a("span",{staticClass:"mord mathit",staticStyle:{"margin-right":"0.03588em"}},[t._v("g")]),a("span",{staticClass:"mord mathit"},[t._v("h")]),a("span",{staticClass:"mord"},[a("span",{staticClass:"mord mathit"},[t._v("t")]),a("span",{staticClass:"vlist"},[a("span",{staticStyle:{top:"0.15em","margin-right":"0.05em","margin-left":"0em"}},[a("span",{staticClass:"fontsize-ensurer reset-size5 size5"},[a("span",{staticStyle:{"font-size":"0em"}},[t._v("​")])]),a("span",{staticClass:"reset-textstyle scriptstyle cramped"},[a("span",{staticClass:"mord scriptstyle cramped"},[a("span",{staticClass:"mord mathit"},[t._v("n")]),a("span",{staticClass:"mord mathit"},[t._v("e")]),a("span",{staticClass:"mord mathit",staticStyle:{"margin-right":"0.02691em"}},[t._v("w")])])])]),a("span",{staticClass:"baseline-fix"},[a("span",{staticClass:"fontsize-ensurer reset-size5 size5"},[a("span",{staticStyle:{"font-size":"0em"}},[t._v("​")])]),t._v("​")])])]),a("span",{staticClass:"mrel"},[t._v("=")]),a("span",{staticClass:"mord mathit",staticStyle:{"margin-right":"0.02691em"}},[t._v("w")]),a("span",{staticClass:"mord mathit"},[t._v("e")]),a("span",{staticClass:"mord mathit"},[t._v("i")]),a("span",{staticClass:"mord mathit",staticStyle:{"margin-right":"0.03588em"}},[t._v("g")]),a("span",{staticClass:"mord mathit"},[t._v("h")]),a("span",{staticClass:"mord"},[a("span",{staticClass:"mord mathit"},[t._v("t")]),a("span",{staticClass:"vlist"},[a("span",{staticStyle:{top:"0.15em","margin-right":"0.05em","margin-left":"0em"}},[a("span",{staticClass:"fontsize-ensurer reset-size5 size5"},[a("span",{staticStyle:{"font-size":"0em"}},[t._v("​")])]),a("span",{staticClass:"reset-textstyle scriptstyle cramped"},[a("span",{staticClass:"mord scriptstyle cramped"},[a("span",{staticClass:"mord mathit"},[t._v("o")]),a("span",{staticClass:"mord mathit",staticStyle:{"margin-right":"0.01968em"}},[t._v("l")]),a("span",{staticClass:"mord mathit"},[t._v("d")])])])]),a("span",{staticClass:"baseline-fix"},[a("span",{staticClass:"fontsize-ensurer reset-size5 size5"},[a("span",{staticStyle:{"font-size":"0em"}},[t._v("​")])]),t._v("​")])])]),a("span",{staticClass:"mbin"},[t._v("−")]),a("span",{staticClass:"mord mathit",staticStyle:{"margin-right":"0.01968em"}},[t._v("l")]),a("span",{staticClass:"mord mathit",staticStyle:{"margin-right":"0.02778em"}},[t._v("r")]),a("span",{staticClass:"mbin"},[t._v("∗")]),a("span",{staticClass:"mord mathit",staticStyle:{"margin-right":"0.03588em"}},[t._v("g")]),a("span",{staticClass:"mord mathit",staticStyle:{"margin-right":"0.02778em"}},[t._v("r")]),a("span",{staticClass:"mord mathit"},[t._v("a")]),a("span",{staticClass:"mord mathit"},[t._v("d")]),a("span",{staticClass:"mord mathit"},[t._v("i")]),a("span",{staticClass:"mord mathit"},[t._v("e")]),a("span",{staticClass:"mord mathit"},[t._v("n")]),a("span",{staticClass:"mord mathit"},[t._v("t")]),a("span",{staticClass:"mord mathit"},[t._v("s")])])])])])]),t._v(" "),a("p",[t._v("其中的减号使得无论当前梯度是正还是负，最终新权重的方向必然是使得loss下降的方向移动；如果反过来改成加号，并且将weight改为输入x，就相当于给输入加一个小的扰动，从而进行对抗学习")]),t._v(" "),a("p",[a("span",{staticClass:"katex-display"},[a("span",{staticClass:"katex"},[a("span",{staticClass:"katex-mathml"},[a("math",[a("semantics",[a("mrow",[a("mi",[t._v("x")]),a("mo",[t._v("=")]),a("mi",[t._v("x")]),a("mo",[t._v("+")]),a("mi",{attrs:{mathvariant:"normal"}},[t._v("Δ")]),a("mi",[t._v("x")])],1),a("annotation",{attrs:{encoding:"application/x-tex"}},[t._v("x = x+\\Delta x\n")])],1)],1)],1),a("span",{staticClass:"katex-html",attrs:{"aria-hidden":"true"}},[a("span",{staticClass:"strut",staticStyle:{height:"0.68333em"}}),a("span",{staticClass:"strut bottom",staticStyle:{height:"0.76666em","vertical-align":"-0.08333em"}}),a("span",{staticClass:"base displaystyle textstyle uncramped"},[a("span",{staticClass:"mord mathit"},[t._v("x")]),a("span",{staticClass:"mrel"},[t._v("=")]),a("span",{staticClass:"mord mathit"},[t._v("x")]),a("span",{staticClass:"mbin"},[t._v("+")]),a("span",{staticClass:"mord mathrm"},[t._v("Δ")]),a("span",{staticClass:"mord mathit"},[t._v("x")])])])])])]),t._v(" "),a("p",[t._v("对于CV来说，直接在原始输入上添加一个小扰动，不会特别影响图片，但是在文本上，本质上是one-hot向量，而两个one-hot向量距离为"),a("span",{staticClass:"katex"},[a("span",{staticClass:"katex-mathml"},[a("math",[a("semantics",[a("mrow",[a("msqrt",[a("mn",[t._v("2")])],1)],1),a("annotation",{attrs:{encoding:"application/x-tex"}},[t._v("\\sqrt2")])],1)],1)],1),a("span",{staticClass:"katex-html",attrs:{"aria-hidden":"true"}},[a("span",{staticClass:"strut",staticStyle:{height:"0.9072200000000001em"}}),a("span",{staticClass:"strut bottom",staticStyle:{height:"1.04em","vertical-align":"-0.13277999999999995em"}}),a("span",{staticClass:"base textstyle uncramped"},[a("span",{staticClass:"sqrt mord"},[a("span",{staticClass:"sqrt-sign",staticStyle:{top:"-0.06722000000000006em"}},[a("span",{staticClass:"style-wrap reset-textstyle textstyle uncramped"},[t._v("√")])]),a("span",{staticClass:"vlist"},[a("span",{staticStyle:{top:"0em"}},[a("span",{staticClass:"fontsize-ensurer reset-size5 size5"},[a("span",{staticStyle:{"font-size":"1em"}},[t._v("​")])]),a("span",{staticClass:"mord mathrm"},[t._v("2")])]),a("span",{staticStyle:{top:"-0.8272200000000001em"}},[a("span",{staticClass:"fontsize-ensurer reset-size5 size5"},[a("span",{staticStyle:{"font-size":"1em"}},[t._v("​")])]),a("span",{staticClass:"reset-textstyle textstyle uncramped sqrt-line"})]),a("span",{staticClass:"baseline-fix"},[a("span",{staticClass:"fontsize-ensurer reset-size5 size5"},[a("span",{staticStyle:{"font-size":"1em"}},[t._v("​")])]),t._v("​")])])])])])]),t._v("，因此不存在什么扰动，因此将扰动添加到embedding层。")]),t._v(" "),a("p",[t._v("FGM相对于FGSM主要是对计算扰动的地方进行了改变，FGSM中， 使用sgn函数(控制扰动在-1～1内)，因此扰动肯定沿着梯度的方向往损失函数的极大值移动")]),t._v(" "),a("p",[a("span",{staticClass:"katex-display"},[a("span",{staticClass:"katex"},[a("span",{staticClass:"katex-mathml"},[a("math",[a("semantics",[a("mrow",[a("mi",{attrs:{mathvariant:"normal"}},[t._v("Δ")]),a("mi",[t._v("x")]),a("mo",[t._v("=")]),a("mi",[t._v("ϵ")]),a("mo",[t._v("∗")]),a("mi",[t._v("s")]),a("mi",[t._v("i")]),a("mi",[t._v("g")]),a("mi",[t._v("n")]),a("mo",[t._v("(")]),a("mi",[t._v("g")]),a("mo",[t._v(")")])],1),a("annotation",{attrs:{encoding:"application/x-tex"}},[t._v("\\Delta x=\\epsilon * sign(g)\n")])],1)],1)],1),a("span",{staticClass:"katex-html",attrs:{"aria-hidden":"true"}},[a("span",{staticClass:"strut",staticStyle:{height:"0.75em"}}),a("span",{staticClass:"strut bottom",staticStyle:{height:"1em","vertical-align":"-0.25em"}}),a("span",{staticClass:"base displaystyle textstyle uncramped"},[a("span",{staticClass:"mord mathrm"},[t._v("Δ")]),a("span",{staticClass:"mord mathit"},[t._v("x")]),a("span",{staticClass:"mrel"},[t._v("=")]),a("span",{staticClass:"mord mathit"},[t._v("ϵ")]),a("span",{staticClass:"mbin"},[t._v("∗")]),a("span",{staticClass:"mord mathit"},[t._v("s")]),a("span",{staticClass:"mord mathit"},[t._v("i")]),a("span",{staticClass:"mord mathit",staticStyle:{"margin-right":"0.03588em"}},[t._v("g")]),a("span",{staticClass:"mord mathit"},[t._v("n")]),a("span",{staticClass:"mopen"},[t._v("(")]),a("span",{staticClass:"mord mathit",staticStyle:{"margin-right":"0.03588em"}},[t._v("g")]),a("span",{staticClass:"mclose"},[t._v(")")])])])])])]),t._v(" "),a("p",[t._v("而在FGM中，根据梯度用L2进行scale，这样保留了各个维度的相对大小，不至于直接转为-1～1，获得更好的样本")]),t._v(" "),a("p",[a("span",{staticClass:"katex-display"},[a("span",{staticClass:"katex"},[a("span",{staticClass:"katex-mathml"},[a("math",[a("semantics",[a("mrow",[a("mi",{attrs:{mathvariant:"normal"}},[t._v("Δ")]),a("mi",[t._v("x")]),a("mo",[t._v("=")]),a("mi",[t._v("ϵ")]),a("mo",[t._v("∗")]),a("mi",[t._v("g")]),a("mi",{attrs:{mathvariant:"normal"}},[t._v("/")]),a("mi",[t._v("n")]),a("mi",[t._v("o")]),a("mi",[t._v("r")]),a("mi",[t._v("m")]),a("mo",[t._v("(")]),a("mi",[t._v("g")]),a("mo",[t._v(")")])],1),a("annotation",{attrs:{encoding:"application/x-tex"}},[t._v("\\Delta x=\\epsilon * g/ norm(g)\n")])],1)],1)],1),a("span",{staticClass:"katex-html",attrs:{"aria-hidden":"true"}},[a("span",{staticClass:"strut",staticStyle:{height:"0.75em"}}),a("span",{staticClass:"strut bottom",staticStyle:{height:"1em","vertical-align":"-0.25em"}}),a("span",{staticClass:"base displaystyle textstyle uncramped"},[a("span",{staticClass:"mord mathrm"},[t._v("Δ")]),a("span",{staticClass:"mord mathit"},[t._v("x")]),a("span",{staticClass:"mrel"},[t._v("=")]),a("span",{staticClass:"mord mathit"},[t._v("ϵ")]),a("span",{staticClass:"mbin"},[t._v("∗")]),a("span",{staticClass:"mord mathit",staticStyle:{"margin-right":"0.03588em"}},[t._v("g")]),a("span",{staticClass:"mord mathrm"},[t._v("/")]),a("span",{staticClass:"mord mathit"},[t._v("n")]),a("span",{staticClass:"mord mathit"},[t._v("o")]),a("span",{staticClass:"mord mathit",staticStyle:{"margin-right":"0.02778em"}},[t._v("r")]),a("span",{staticClass:"mord mathit"},[t._v("m")]),a("span",{staticClass:"mopen"},[t._v("(")]),a("span",{staticClass:"mord mathit",staticStyle:{"margin-right":"0.03588em"}},[t._v("g")]),a("span",{staticClass:"mclose"},[t._v(")")])])])])])]),t._v(" "),a("p",[t._v("FGM通过"),a("span",{staticClass:"katex"},[a("span",{staticClass:"katex-mathml"},[a("math",[a("semantics",[a("mrow",[a("mi",[t._v("ϵ")])],1),a("annotation",{attrs:{encoding:"application/x-tex"}},[t._v("\\epsilon")])],1)],1)],1),a("span",{staticClass:"katex-html",attrs:{"aria-hidden":"true"}},[a("span",{staticClass:"strut",staticStyle:{height:"0.43056em"}}),a("span",{staticClass:"strut bottom",staticStyle:{height:"0.43056em","vertical-align":"0em"}}),a("span",{staticClass:"base textstyle uncramped"},[a("span",{staticClass:"mord mathit"},[t._v("ϵ")])])])]),t._v("一步计算出对抗扰动，但这样得到的可能不是最优的，因此PGD进行了改动，改为小步走，多走几步，如果走出"),a("span",{staticClass:"katex"},[a("span",{staticClass:"katex-mathml"},[a("math",[a("semantics",[a("mrow",[a("mi",[t._v("ϵ")])],1),a("annotation",{attrs:{encoding:"application/x-tex"}},[t._v("\\epsilon")])],1)],1)],1),a("span",{staticClass:"katex-html",attrs:{"aria-hidden":"true"}},[a("span",{staticClass:"strut",staticStyle:{height:"0.43056em"}}),a("span",{staticClass:"strut bottom",staticStyle:{height:"0.43056em","vertical-align":"0em"}}),a("span",{staticClass:"base textstyle uncramped"},[a("span",{staticClass:"mord mathit"},[t._v("ϵ")])])])]),t._v("的区间，就映射"),a("span",{staticClass:"katex"},[a("span",{staticClass:"katex-mathml"},[a("math",[a("semantics",[a("mrow",[a("mi",[t._v("ϵ")])],1),a("annotation",{attrs:{encoding:"application/x-tex"}},[t._v("\\epsilon")])],1)],1)],1),a("span",{staticClass:"katex-html",attrs:{"aria-hidden":"true"}},[a("span",{staticClass:"strut",staticStyle:{height:"0.43056em"}}),a("span",{staticClass:"strut bottom",staticStyle:{height:"0.43056em","vertical-align":"0em"}}),a("span",{staticClass:"base textstyle uncramped"},[a("span",{staticClass:"mord mathit"},[t._v("ϵ")])])])]),t._v("范围内，保证扰动不会太大")]),t._v(" "),a("h3",{attrs:{id:"训练代码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#训练代码"}},[t._v("#")]),t._v(" 训练代码")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/lianyongxing/text-classification-nlp-pytorch/blob/main/model/fgm.py",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/lianyongxing/text-classification-nlp-pytorch/blob/main/model/fgm.py"),a("OutboundLink")],1)]),t._v(" "),a("h3",{attrs:{id:"references"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#references"}},[t._v("#")]),t._v(" References")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://arxiv.org/abs/1605.07725",target:"_blank",rel:"noopener noreferrer"}},[t._v("Adversarial Training Methods for Semi-Supervised Text Classification (ICLR2017)"),a("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=e.exports}}]);