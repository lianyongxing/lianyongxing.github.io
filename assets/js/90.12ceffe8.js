(window.webpackJsonp=window.webpackJsonp||[]).push([[90],{688:function(a,s,t){"use strict";t.r(s);var e=t(44),r=Object(e.a)({},(function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h2",{attrs:{id:"mongodb分片"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mongodb分片"}},[a._v("#")]),a._v(" Mongodb分片")]),a._v(" "),t("h3",{attrs:{id:"架构"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#架构"}},[a._v("#")]),a._v(" 架构")]),a._v(" "),t("p",[a._v("节点：localhost（使用单机多端口实现）")]),a._v(" "),t("p",[a._v("架构说明（数字为端口）：")]),a._v(" "),t("p",[a._v("27018：config server（master）")]),a._v(" "),t("p",[a._v("27019：config server（slave）")]),a._v(" "),t("p",[a._v("27020：shard_master")]),a._v(" "),t("p",[a._v("27021：shard_slave")]),a._v(" "),t("p",[a._v("27022：shard_arbiter")]),a._v(" "),t("p",[a._v("27023：shard2")]),a._v(" "),t("p",[a._v("27024：router")]),a._v(" "),t("h3",{attrs:{id:"configserver配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#configserver配置"}},[a._v("#")]),a._v(" configServer配置")]),a._v(" "),t("h4",{attrs:{id:"编写配置文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#编写配置文件"}},[a._v("#")]),a._v(" 编写配置文件")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("directoryperdb=true\nreplSet=config\nconfigsvr=true\nlogpath=/home/mymongo/config_master/mongod.log\nlogappend=true\nfork=true\nport=27018\ndbpath=/home/mymongo/config_master\npidfilepath=/home/mymongo/config_master/mongod.pid\n")])])]),t("h4",{attrs:{id:"master和slave都配置好后，启动服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#master和slave都配置好后，启动服务"}},[a._v("#")]),a._v(" master和slave都配置好后，启动服务")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("mongod -f mongo.conf\n")])])]),t("h4",{attrs:{id:"在主节点上配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#在主节点上配置"}},[a._v("#")]),a._v(" 在主节点上配置")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("use admin\n")])])]),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("cfg={_id:\"config\",members:[{_id:0,host:'localhost:27018',priority:2}, {_id:1,host:'localhost:27019',priority:1}]};\n")])])]),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("rs.initiate(cfg)\n")])])]),t("h4",{attrs:{id:"从节点上进行开启"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#从节点上进行开启"}},[a._v("#")]),a._v(" 从节点上进行开启")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("rs.slaveOk()\n")])])]),t("h3",{attrs:{id:"配置shards"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置shards"}},[a._v("#")]),a._v(" 配置shards")]),a._v(" "),t("h4",{attrs:{id:"编写配置文件-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#编写配置文件-2"}},[a._v("#")]),a._v(" 编写配置文件")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("directoryperdb=true\nreplSet=shard\nshardsvr = true\nlogpath=/home/mymongo/shard_master/mongod.log\nlogappend=true\nfork=true\nport=27020\ndbpath=/home/mymongo/shard_master\npidfilepath=/home/mymongo/shard_master/mongod.pid\n")])])]),t("h4",{attrs:{id:"master、slave、arbiter都配置好后，分别启动"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#master、slave、arbiter都配置好后，分别启动"}},[a._v("#")]),a._v(" master、slave、arbiter都配置好后，分别启动")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("mongod -f mongo.conf\n")])])]),t("h4",{attrs:{id:"进入主节点进行配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#进入主节点进行配置"}},[a._v("#")]),a._v(" 进入主节点进行配置")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("use admin\n")])])]),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("cfg={_id:\"shard\",members:[{_id:0,host:'localhost:27020',priority:2}, {_id:1,host:'localhost:27021',priority:1},{_id:2,host:'localhost:27022',arbiterOnly:true}]};\n")])])]),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("rs.initiate(cfg)\n")])])]),t("h4",{attrs:{id:"开启从节点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#开启从节点"}},[a._v("#")]),a._v(" 开启从节点")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("rs.slaveOk()\n")])])]),t("h4",{attrs:{id:"配置另一个分片"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置另一个分片"}},[a._v("#")]),a._v(" 配置另一个分片")]),a._v(" "),t("p",[a._v("按照相同方法配置另一个分片")]),a._v(" "),t("h3",{attrs:{id:"配置路由节点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置路由节点"}},[a._v("#")]),a._v(" 配置路由节点")]),a._v(" "),t("h4",{attrs:{id:"编写配置文件-3"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#编写配置文件-3"}},[a._v("#")]),a._v(" 编写配置文件")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("configdb = config/localhost:27019,localhost:27018\nlogpath=/home/mymongo/router/mongod.log\nlogappend=true\nfork=true\nport=27024\npidfilepath=/home/mymongo/router/mongod.pid\n")])])]),t("h4",{attrs:{id:"用mongos启动"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#用mongos启动"}},[a._v("#")]),a._v(" 用mongos启动")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("mongos -f router.conf\n")])])]),t("h4",{attrs:{id:"配置具体的分片策略"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置具体的分片策略"}},[a._v("#")]),a._v(" 配置具体的分片策略")]),a._v(" "),t("p",[a._v("登陆mongos服务器")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("mongo --port=27024\n")])])]),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("use admin\n")])])]),t("p",[a._v("添加自己的分片划分")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('sh.addShard("shard/localhost:27020,localhost:27021,localhost:27022");\n')])])]),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('sh.addShard("shard2/localhost:27023");\n')])])]),t("p",[a._v("在mongos上为具体的数据库配置sharding")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('sh.enableSharding("test")\n')])])]),t("p",[a._v("对test.t集合以id列为shard key进行hashed sharding")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('sh.shardCollection("test.t",{id:"hashed"})\n')])])]),t("p",[a._v("可以看到自动为id列创建了索引")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("db.t.getIndexes()\n")])])]),t("h4",{attrs:{id:"分片验证"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#分片验证"}},[a._v("#")]),a._v(" 分片验证")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("use test\n")])])]),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('for(i=1,i<=1000,i++){db.t.insert({id:i,name:"Lihua"})}\n')])])]),t("p",[a._v("可以看到数据被分配到两个分片当中，分片集群搭建完成")])])}),[],!1,null,null,null);s.default=r.exports}}]);